actor Client
participant Server
participant Handler
participant Service
participant DataAccess
database db

entryspacing 0.9
group#43829c #lightblue Registration
Client -> Server: [POST] /user\n{"username":" ", "password":" ", "email":" "}
Server -> Handler: {"username":" ", "password":" ", "email":" "}
Handler -> Service: register(RegisterRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db:Find UserData by username
break User with username already exists
DataAccess --> Service: UserData
Service --> Server: AlreadyTakenException
Server --> Client: 403\n{"message": "Error: username already taken"}
end
DataAccess --> Service: null
Service -> DataAccess:createUser(userData)
DataAccess -> db:Add UserData
Service -> DataAccess:createAuth(authData)
DataAccess -> db:Add AuthData
Service --> Handler: RegisterResult
Handler --> Server: {"username" : " ", "authToken" : " "}
Server --> Client: 200\n{"username" : " ", "authToken" : " "}
end

group#orange #FCEDCA Login
Client -> Server: [POST] /session\n{"username", " " "password": " "}
Server -> Handler: {"username":" ", "password":" "}
Handler -> Service: login(LoginRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db: Find UserData by username
break User with username does not exist
DataAccess --> Service: null
Service --> Server: UserNotFoundException
Server --> Client: 500\n{"message": "Error: username not found"}
end
DataAccess --> Service: UserData
break Password is incorrect
Service --> Server: PasswordIncorrectException 
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
Service -> DataAccess: createAuth(authData)
DataAccess -> db: Add AuthData
Service --> Handler: LoginResult
Handler --> Server: {"username":" ", "authToken":" "}
Server --> Client: 200\n{"username":" ", "authToken":" "}
end

group#green #lightgreen Logout
Client -> Server: [DELETE] /session\nauthToken
Server -> Handler: authToken
Handler -> Service: logout(logoutRequest)
Service -> DataAccess: getAuth(authData)
DataAccess -> db: Get authorization
break User is unauthorized
DataAccess --> Service: null
Service --> Server: UserUnauthorizedException
Server --> Client: 401\n{"message":"Error: unauthorized"}
end
DataAccess --> Service: authData
Service -> DataAccess: deleteAuth(authData)
DataAccess -> db: Delete authData
Service --> Handler: LogoutResult
Handler --> Server: {}
Server --> Client: 200\n{}

end

group#red #pink List Games
Client -> Server: [GET] /game\nauthToken
Server -> Handler: authToken
Handler -> Service: listGames(listGamesRequest)
Service -> DataAccess: getAuth(authData)
DataAccess -> db: Get authorization
break User not authorized
DataAccess --> Service: null
Service --> Server: UserUnauthorizedException
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
DataAccess --> Service: authData
Service -> DataAccess: listGames()
DataAccess -> db: Get current games
DataAccess --> Service: gameData
Service --> Handler: GameListResult
Handler --> Server: {"games": []}
Server --> Client: 200\n{"games": []}
end

group#d790e0 #E3CCE6 Create Game 
Client -> Server: [POST] /game\nauthToken\n{"gameName": " "}
Server -> Handler:  authToken\n{"gameName": " "}
Handler -> Service: createGame(CreateGameRequest)
Service -> DataAccess: getAuth(authData)
DataAccess -> db: Get authorization
break
DataAccess --> Service: null
Service --> Server: UserUnauthorizedException
Server --> Client: 401\n{"message" : "Error: unauthorized"}
end
DataAccess --> Service: authData
Service -> DataAccess: getGame(gameName)
DataAccess -> db: Get game
break Game already exists
DataAccess --> Service: gameData
Service --> Server: GameAlreadyExistsException
Server --> Client: 500\n{"message": "Game already exists."}
end
DataAccess --> Service: null
Service -> DataAccess: createGame(gameName)
DataAccess -> db: Create new game
DataAccess --> Service: gameData
Service --> Handler: CreateGameResult
Handler --> Server: {"gameID" : " "}
Server --> Client: 200\n{"gameID" : " "}
end

group#yellow #lightyellow Join Game #black
Client -> Server: [PUT] /game\nauthToken\n{"playerColor": " ", "gameID": " "}
Server -> Handler: authToken\n{"playerColor": " ", "gameID": " "}
Handler -> Service: joinGame(JoinGameRequest)
Service -> DataAccess: getAuth(authToken)
DataAccess -> db: Get authorization
break
DataAccess --> Service: null
Service --> Server: UserUnauthorizedException
Server --> Client: 401\n{"message" : "Error: unauthorized"}
end
DataAccess --> Service: authData
Service -> DataAccess: getGame(gameID)
DataAccess -> db: Get gameData by ID
break
DataAccess --> Service: null
Service --> Server: GameNotFoundException
Server --> Client: 500\n{"message" : "Error: game not found"}
service
end
DataAccess --> Service: gameData
break 
Service --> Server: GameAlreadyTakenException
Server --> Client: 403\n{"message": "Error: Game already taken"}
end
Service -> DataAccess: updateGame(gameID, updatedGame)
DataAccess -> db: Overwrite game string, now with new user
Service --> Handler: JoinGameResult
Handler --> Server: { "playerColor":"WHITE/BLACK", "gameID": 1234 }
Server --> Client: 200\n{ "playerColor":"WHITE/BLACK", "gameID": 1234 }
end

group#gray #lightgray Clear application 
Client -> Server: [DELETE] /db\nauthToken
Server -> Handler: authToken
Handler -> Service: delete(DeleteRequest)
Service -> DataAccess: getAuth(authToken)
DataAccess -> db: Get authorization
break
DataAccess --> Service: null
Service --> Server: UserUnauthorizedException
Server --> Client: 401\n{"message" : "Error: unauthorized"}
end
DataAccess --> Service: authData
Service -> DataAccess: clearDataBase()
DataAccess -> db: Clear Database of all users, games, and authTokens
Service --> Handler: DeleteResult
Handler --> Server: {}
Server --> Client: 200\n{}
end
